<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         point="org.eclipse.mylyn.tasks.ui.repositories">
      <connectorCore
            class="com.atlassian.connector.eclipse.internal.fisheye.core.FishEyeRepositoryConnector"
            id="fisheye"
            name="FishEye">
      </connectorCore>
      <connectorUi
            brandingIcon="icons/obj16/fisheye-16.png"
            class="com.atlassian.connector.eclipse.internal.fisheye.ui.FishEyeRepositoryConnectorUi"
            id="fisheye"
            name="FishEye"
            overlayIcon="icons/obj16/fisheye-overlay.png">
      </connectorUi>
   </extension>
   <extension point="org.eclipse.ui.menus">
	<!-- Show in FishEye -->

      <menuContribution
            locationURI="popup:org.eclipse.ui.menus.showInMenu">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.showInFishEyeCommand"
               style="push">
         </command>
      </menuContribution>
	   
	<!-- copy FishEye link to clipboard functionalities -->
	
	<!-- this is somewhat crazy: I am trying to plug into using several means to be position the actions
	in the optimal place: near Copy section - if possible or at the very end (additions) section
	as last resort. Unfortunately sections (separator) are not named consistently across Cclipse --> 

      <menuContribution
            locationURI="popup:org.eclipse.ui.popup.any?after=additions">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
               style="push">
			  <visibleWhen>
			  <and>
			    <or>
			  	<with variable="selection">
			  		<count value="1"/>
			  		<iterate>
			  			<or>
			  				<adapt type="org.eclipse.core.resources.IFile"/>
			  				<adapt type="org.eclipse.core.resources.IFolder"/>
			  				<adapt type="org.eclipse.core.resources.IResource"/>
			  			</or>
			  		</iterate>
			  	</with>
			  	<instanceof value="org.eclipse.core.resources.IResource"/>
					<or>
						<adapt type="org.eclipse.core.resources.IFile"/>
						<adapt type="org.eclipse.core.resources.IFolder"/>
						<adapt type="org.eclipse.core.resources.IResource"/>
					</or>
			  	</or>
				<with variable="activePartId">
				<not><or>
<!--					<equals value="org.eclipse.ui.views.ContentOutline"/> -->
					<equals value="org.eclipse.ui.navigator.ProjectExplorer"/>
					<equals value="org.eclipse.jdt.ui.PackageExplorer"/>
				</or></not>
				</with>
			  	</and>
			  </visibleWhen>
         </command>
      </menuContribution>
      <menuContribution
            locationURI="popup:org.eclipse.ui.popup.any?after=group.copy">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
               style="push">
         </command>
      </menuContribution>
      
      <menuContribution
            locationURI="menu:edit?before=cut.ext">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
               style="push">
         </command>
      </menuContribution>

      <menuContribution 
      		locationURI="popup:org.eclipse.ui.navigator.ProjectExplorer#PopupMenu?after=group.edit">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
               style="push">
         </command>
      </menuContribution>
      
      <menuContribution
            locationURI="popup:org.eclipse.jdt.ui.PackageExplorer?after=group.edit">
         <command
               commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
               style="push">
         </command>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.commands">
      <command
            description="Show in FishEye tooltip (todo)"
            id="com.atlassian.connector.eclipse.fisheye.ui.showInFishEyeCommand"
            name="FishEye">
      </command>
      <command
            description="Copy FishEye Link to Clipboard"
            id="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
            name="Copy FishEye Link to Clipboard">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.commandImages">
      <image
            commandId="com.atlassian.connector.eclipse.fisheye.ui.showInFishEyeCommand"
            icon="icons/obj16/fisheye-16.png">
      </image>
      <image
            commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand"
            icon="icons/obj16/fisheye-16.png">
      </image>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="com.atlassian.connector.eclipse.internal.fisheye.ui.command.ShowInFishEyeCommand"
            commandId="com.atlassian.connector.eclipse.fisheye.ui.showInFishEyeCommand">
      </handler>
      <handler
            class="com.atlassian.connector.eclipse.internal.fisheye.ui.command.CopyFishEyeLinkToClipboardCommand"
            commandId="com.atlassian.connector.eclipse.fisheye.ui.copyFishEyeLinkToClipboardCommand">
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.preferencePages">
      <page
            category="com.atlassian.connector.eclipse.ui.preferences.AtlassianPreferencePage"
            class="com.atlassian.connector.eclipse.fisheye.ui.preferences.FishEyePreferencePage"
            id="com.atlassian.connector.eclipse.fisheye.ui.preferences.FishEyePreferencePage"
            name="FishEye">
      </page>
   </extension>

</plugin>
